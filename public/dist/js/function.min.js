$().ready(function () {
    $('.cep').mask('00000-000');

    $('.limpar').on('click', function limpa_formulário_cep() {
        // Limpa valores do formulário de cep.
        $("#result").empty();
        $(".cep").val('');
    });

    $('.pesquisar').on('click', function buscaCEP(cep) {
        var cep = $('.cep').val().replace(/\D/g, '');
        var url = 'https://viacep.com.br/ws/';

        //Expressão regular para validar o CEP.
        var validacep = /^[0-9]{8}$/;

        //Valida o formato do CEP.
        if (validacep.test(cep)) {

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    mCarrega(this);
                } else {
                    var result = "";
                    result += '<div class="message-body"> ';
                    result += '<div class="list-group">';
                    result += '<div class="list-group-item list-group-item-danger"><strong> CEP não localizado. veirifique o CEP e tente novamente! </strong> </div>';
                    result += '</div>';
                    result += '</div >';

                    $("#result").html(result);
                }
            };
            xhttp.open("GET", url + cep + "/xml/", true);
            xhttp.send();

            function mCarrega(xml) {
                var result = "";
                var doc = xml.responseXML;
                var varcep = doc.getElementsByTagName('xmlcep');

                for (var i = 0; i < varcep.length; i++) {
                    result += '<div class="message-body"> ';
                    result += '<div class="list-group">';
                    result += '<div class="list-group-item active"><strong> CEP: </strong>' + varcep[i].getElementsByTagName('cep')[0].childNodes[0].nodeValue + '</div>';
                    result += '<div class="list-group-item"><strong> Rua: </strong>' + varcep[i].getElementsByTagName('logradouro')[0].childNodes[0].nodeValue + '</div>';
                    result += '<div class="list-group-item"><strong> Bairro: </strong>' + varcep[i].getElementsByTagName('bairro')[0].childNodes[0].nodeValue + '</div>';
                    result += '<div class="list-group-item"><strong> Cidade: </strong>' + varcep[i].getElementsByTagName('localidade')[0].childNodes[0].nodeValue + '</div>';
                    result += '<div class="list-group-item"><strong> Estado: </strong>' + varcep[i].getElementsByTagName('uf')[0].childNodes[0].nodeValue + '</div>';
                    result += '</div>';
                    result += '</div >';
                }
                $("#result").html(result);
            }


        } else {
            var result = "";
            result += '<div class="message-body"> ';
            result += '<div class="list-group">';
            result += '<div class="list-group-item list-group-item-danger"><strong> CEP não localizado. veirifique o CEP e tente novamente! </strong> </div>';
            result += '</div>';
            result += '</div >';

            $("#result").html(result);
        }


    });

});